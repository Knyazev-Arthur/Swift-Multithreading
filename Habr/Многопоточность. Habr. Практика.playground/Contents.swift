import UIKit
import PlaygroundSupport

PlaygroundPage.current.needsIndefiniteExecution = true

let mySerialQueue = DispatchQueue(label: "DispatchQueueValue")
var value = "üòé"

func changeValue(variant: Int) {
    sleep(1)
    value = value + "üêì"
    print("\(value) - \(variant)")
}

//
/*
 –ö–æ–≥–¥–∞ –≤—ã –≤—ã–∑—ã–≤–∞–µ—Ç–µ mySerialQueue.async, –∑–∞–¥–∞—á–∞ –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ —Ñ–æ–Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ, –Ω–æ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–ª–µ–µ –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏. –ü–æ—ç—Ç–æ–º—É –≤—ã–∑–æ–≤ print(value) –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥—å, –Ω–µ –¥–æ–∂–∏–¥–∞—è—Å—å –µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –≤—ã–≤–æ–¥–∏—Ç —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π value, –∫–æ—Ç–æ—Ä–æ–µ –µ—â–µ –Ω–µ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ –∑–∞–¥–∞—á–µ–π –≤ —Ñ–æ–Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ.
 */
//mySerialQueue.async {
//    changeValue(variant: 1)
//}
//print(value)
//—ç—Ç–æ –ø—Ä–∏–º–µ—Ä –≥–æ–Ω–∫–∏ –¥–∞–Ω–Ω—ã—Ö (race condition). –ì–æ–Ω–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ –∏–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ø—ã—Ç–∞—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –æ–±—â–∏–º –¥–∞–Ω–Ω—ã–º –∏ –∏–∑–º–µ–Ω–∏—Ç—å –∏—Ö, –ø—Ä–∏ —ç—Ç–æ–º –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –∑–∞—Ä–∞–Ω–µ–µ. –í –≤–∞—à–µ–º —Å–ª—É—á–∞–µ, –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π value –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ —É–∂–µ –≤—ã–≤–µ–ª –µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.

mySerialQueue.sync {
    changeValue(variant: 1)
}
print(value)

value = "ü¶â"
mySerialQueue.sync {
    changeValue(variant: 1)
}
print(value)
